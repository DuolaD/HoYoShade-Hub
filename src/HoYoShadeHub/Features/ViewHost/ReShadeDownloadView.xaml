<UserControl x:Class="HoYoShadeHub.Features.ViewHost.ReShadeDownloadView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:lang="using:HoYoShadeHub.Language"
             x:DefaultBindMode="OneWay"
             mc:Ignorable="d">

    <Grid Loaded="Grid_Loaded">
        <Image HorizontalAlignment="Center"
               VerticalAlignment="Center"
               Source="ms-appx:///Assets/Image/UI_CutScene_1130320101A.png"
               Stretch="UniformToFill" />
        <Rectangle HorizontalAlignment="Stretch"
                   VerticalAlignment="Stretch"
                   Fill="{ThemeResource ControlOnImageFillColorDefaultBrush}" />

        <!-- Installation Status Panel (Top Right) -->
        <StackPanel Canvas.ZIndex="10"
                    Margin="0,48,48,0"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Spacing="8">
            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="12,8">
                <StackPanel Spacing="6">
                    <TextBlock Text="{x:Bind lang:Lang.HoYoShadeDownloadView_InstallStatus}"
                               FontSize="12"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    
                    <!-- HoYoShade Status -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <FontIcon Grid.Column="0" 
                                  FontSize="14" 
                                  FontFamily="Segoe Fluent Icons"
                                  Margin="0,0,8,0"
                                  Glyph="{x:Bind IsHoYoShadeInstalled, Mode=OneWay, Converter={StaticResource BoolToInstallGlyphConverter}}" 
                                  Foreground="{x:Bind IsHoYoShadeInstalled, Mode=OneWay, Converter={StaticResource BoolToInstallColorConverter}}" />
                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4">
                            <TextBlock Text="HoYoShade"
                                       FontSize="13" />
                            <TextBlock Text="{x:Bind HoYoShadeVersionDisplay, Mode=OneWay}"
                                       FontSize="13"
                                       Opacity="0.7"/>
                        </StackPanel>
                    </Grid>
                    
                    <!-- OpenHoYoShade Status -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <FontIcon Grid.Column="0" 
                                  FontSize="14" 
                                  FontFamily="Segoe Fluent Icons"
                                  Margin="0,0,8,0"
                                  Glyph="{x:Bind IsOpenHoYoShadeInstalled, Mode=OneWay, Converter={StaticResource BoolToInstallGlyphConverter}}" 
                                  Foreground="{x:Bind IsOpenHoYoShadeInstalled, Mode=OneWay, Converter={StaticResource BoolToInstallColorConverter}}" />
                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4">
                            <TextBlock Text="OpenHoYoShade"
                                       FontSize="13" />
                            <TextBlock Text="{x:Bind OpenHoYoShadeVersionDisplay, Mode=OneWay}"
                                       FontSize="13"
                                       Opacity="0.7"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Language Selector moved below installation status -->
            <ComboBox Name="ComboBox_Language"
                      MinWidth="200"
                      HorizontalAlignment="Stretch"
                      SelectionChanged="ComboBox_Language_SelectionChanged" />
        </StackPanel>

        <StackPanel x:Name="MainContentPanel" 
                    VerticalAlignment="Top" 
                    Spacing="8"
                    Margin="{x:Bind ContentMargin, Mode=OneWay}">
            
            <TextBlock FontSize="18" 
                       Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                       Text="{x:Bind Title, Mode=OneWay}" />

            <!-- Update Hint -->
            <TextBlock Text="如果本次更新涉及到ReShade版本升级，我们建议你更新所有已安装的着色器和插件。"
                       TextWrapping="Wrap"
                       Foreground="{ThemeResource SystemFillColorCautionBrush}"
                       FontSize="13"
                       MaxWidth="800"
                       HorizontalAlignment="Left"
                       Visibility="{x:Bind IsUpdateMode, Mode=OneWay}" />

            <!-- Description -->
            <TextBlock Text="{x:Bind lang:Lang.ReShadeDownloadView_Description}"
                       TextWrapping="Wrap"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       FontSize="11"
                       MaxWidth="800"
                       HorizontalAlignment="Left" />

            <!-- Install Target and Type Selection (Side by Side) -->
            <Grid ColumnSpacing="24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1*" />
                    <ColumnDefinition Width="1*" />
                </Grid.ColumnDefinitions>
                
                <!-- Install Target Selection -->
                <StackPanel Grid.Column="0" Spacing="4">
                    <TextBlock Text="{x:Bind lang:Lang.ReShadeDownloadView_SelectInstallTarget}" 
                               FontSize="12"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    <StackPanel Spacing="4">
                        <RadioButton IsChecked="{x:Bind IsInstallToHoYoShadeOnly, Mode=TwoWay}"
                                     IsEnabled="{x:Bind CanInstallToHoYoShadeOnly, Mode=OneWay}"
                                     GroupName="InstallTarget"
                                     MaxWidth="9999">
                            <TextBlock Text="{x:Bind lang:Lang.ReShadeDownloadView_InstallToHoYoShadeOnly}"
                                       TextWrapping="Wrap"
                                       FontSize="13"
                                       MaxWidth="350" />
                        </RadioButton>
                        
                        <StackPanel Spacing="3">
                            <RadioButton IsChecked="{x:Bind IsInstallToOpenHoYoShadeOnly, Mode=TwoWay}"
                                         IsEnabled="{x:Bind CanInstallToOpenHoYoShadeOnly, Mode=OneWay}"
                                         GroupName="InstallTarget"
                                         MaxWidth="9999">
                                <TextBlock Text="{x:Bind lang:Lang.ReShadeDownloadView_InstallToOpenHoYoShadeOnly}"
                                           TextWrapping="Wrap"
                                           FontSize="13"
                                           MaxWidth="350" />
                            </RadioButton>
                            <TextBlock Text="{x:Bind lang:Lang.ReShadeDownloadView_OpenHoYoShadeWarning}"
                                       TextWrapping="Wrap"
                                       Foreground="{ThemeResource SystemFillColorAttentionBrush}"
                                       FontSize="11"
                                       Margin="28,0,0,0"
                                       Visibility="{x:Bind IsInstallToOpenHoYoShadeOnly, Mode=OneWay}" />
                        </StackPanel>
                        
                        <StackPanel Spacing="3">
                            <RadioButton IsChecked="{x:Bind IsInstallToBoth, Mode=TwoWay}"
                                         IsEnabled="{x:Bind CanInstallToBoth, Mode=OneWay}"
                                         GroupName="InstallTarget"
                                         MaxWidth="9999">
                                <TextBlock Text="{x:Bind lang:Lang.ReShadeDownloadView_InstallToBoth}"
                                           TextWrapping="Wrap"
                                           FontSize="13"
                                           MaxWidth="350" />
                            </RadioButton>
                            <TextBlock Text="{x:Bind lang:Lang.ReShadeDownloadView_BothTargetsWarning}"
                                       TextWrapping="Wrap"
                                       Foreground="{ThemeResource SystemFillColorAttentionBrush}"
                                       FontSize="11"
                                       Margin="28,0,0,0"
                                       Visibility="{x:Bind IsInstallToBoth, Mode=OneWay}" />
                        </StackPanel>
                    </StackPanel>
                </StackPanel>

                <!-- Install Type Selection -->
                <StackPanel Grid.Column="1" Spacing="4">
                    <TextBlock Text="{x:Bind lang:Lang.ReShadeDownloadView_SelectInstallType}" 
                               FontSize="12"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    <StackPanel Spacing="4">
                        <RadioButton IsChecked="{x:Bind IsInstallAll, Mode=TwoWay}"
                                     GroupName="InstallType"
                                     MaxWidth="9999">
                            <TextBlock Text="{x:Bind lang:Lang.ReShadeDownloadView_InstallAll}"
                                       TextWrapping="Wrap"
                                       FontSize="13"
                                       MaxWidth="350" />
                        </RadioButton>
                        <RadioButton IsChecked="{x:Bind IsInstallEssentialOnly, Mode=TwoWay}"
                                     GroupName="InstallType"
                                     MaxWidth="9999">
                            <TextBlock Text="{x:Bind lang:Lang.ReShadeDownloadView_InstallEssentialOnly}"
                                       TextWrapping="Wrap"
                                       FontSize="13"
                                       MaxWidth="350" />
                        </RadioButton>
                        <RadioButton IsChecked="{x:Bind IsCustomizeInstall, Mode=TwoWay}"
                                     GroupName="InstallType"
                                     MaxWidth="9999">
                            <TextBlock Text="{x:Bind lang:Lang.ReShadeDownloadView_CustomizeInstall}"
                                       TextWrapping="Wrap"
                                       FontSize="13"
                                       MaxWidth="350" />
                        </RadioButton>
                    </StackPanel>
                </StackPanel>
            </Grid>

            <!-- Server Selection -->
            <StackPanel Spacing="4">
                <TextBlock Text="{x:Bind lang:Lang.HoYoShadeDownloadView_DownloadServer}" 
                           FontSize="12"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                <ComboBox ItemsSource="{x:Bind DownloadServers}" 
                          SelectedItem="{x:Bind SelectedDownloadServer, Mode=TwoWay}" 
                          MinWidth="240" />
            </StackPanel>

            <!-- Download and Control buttons -->
            <StackPanel Orientation="Horizontal" Spacing="12" Margin="0,12,0,0">
                <Button Content="{x:Bind lang:Lang.ReShadeDownloadView_DownloadAndInstall}" 
                        Command="{x:Bind DownloadCommand}" 
                        Style="{ThemeResource AccentButtonStyle}" 
                        IsEnabled="{x:Bind CanDownload, Mode=OneWay}" />
                
                <Button Command="{x:Bind RefreshCommand}"
                        IsEnabled="{x:Bind CanRefresh, Mode=OneWay}"
                        Visibility="{x:Bind ShowRefreshButton, Mode=OneWay}"
                        ToolTipService.ToolTip="{x:Bind lang:Lang.Common_Refresh}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon FontSize="14" Glyph="&#xE72C;" />
                        <TextBlock Text="{x:Bind lang:Lang.Common_Refresh}" />
                    </StackPanel>
                </Button>
                
                <!-- Customize Button -->
                <Button Command="{x:Bind CustomizeCommand}"
                        IsEnabled="{x:Bind CanRefresh, Mode=OneWay}"
                        Visibility="{x:Bind ShowCustomizeButton, Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon FontSize="14" Glyph="&#xE712;" />
                        <TextBlock Text="{x:Bind lang:Lang.ReShadeDownloadView_CustomizeInstall}" />
                    </StackPanel>
                </Button>

                <!-- Pause Button -->
                <Button Command="{x:Bind PauseCommand}"
                        Visibility="{x:Bind ShowPauseButton, Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon FontSize="14" Glyph="&#xE769;" />
                        <TextBlock Text="{x:Bind lang:Lang.HoYoShadeDownloadView_Pause}" />
                    </StackPanel>
                </Button>
                
                <!-- Stop Button -->
                <Button Command="{x:Bind StopCommand}"
                        Visibility="{x:Bind ShowStopButton, Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon FontSize="14" Glyph="&#xE71A;" />
                        <TextBlock Text="{x:Bind lang:Lang.DownloadGamePage_Stop}" />
                    </StackPanel>
                </Button>
            </StackPanel>

            <StackPanel Spacing="4">
                <ProgressBar Value="{x:Bind DownloadProgress, Mode=OneWay}" Maximum="100" />
                <!-- Status and progress info -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    
                    <!-- Left: Status message -->
                    <TextBlock Grid.Column="0"
                               Text="{x:Bind StatusMessage, Mode=OneWay}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    
                    <!-- Right: Speed and percentage -->
                    <TextBlock Grid.Column="1"
                               Text="{x:Bind SpeedAndProgress, Mode=OneWay}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               HorizontalAlignment="Right" />
                </Grid>
            </StackPanel>

        </StackPanel>

        <!-- Bottom buttons container -->
        <Grid Canvas.ZIndex="10"
              Margin="48,0,80,48"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Bottom">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- Import from Local Button (Left) -->
            <StackPanel Grid.Column="0" Spacing="8">
                <TextBlock Text="{x:Bind lang:Lang.ReShadeDownloadView_ImportHint}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           FontSize="12" />
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <Button Command="{x:Bind ImportFromLocalCommand}"
                            IsEnabled="{x:Bind CanImport, Mode=OneWay}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon FontSize="14" Glyph="&#xE8E5;" />
                            <TextBlock Text="{x:Bind lang:Lang.HoYoShadeDownloadView_SelectPackage}" />
                        </StackPanel>
                    </Button>
                    
                    <Button Command="{x:Bind ImportFromFolderCommand}"
                            IsEnabled="{x:Bind CanImport, Mode=OneWay}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon FontSize="14" Glyph="&#xE8B7;" />
                            <TextBlock Text="{x:Bind lang:Lang.HoYoShadeDownloadView_SelectFolder}" />
                        </StackPanel>
                    </Button>
                </StackPanel>
            </StackPanel>

            <!-- Skip and Next Buttons (Right) -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="12">
                <!-- Skip Button -->
                <Button Height="40"
                        Command="{x:Bind SkipCommand}"
                        IsEnabled="{x:Bind CanSkip, Mode=OneWay}"
                        CornerRadius="20,8,8,20">
                    <TextBlock Margin="8,0,4,0" FontSize="14" Text="{x:Bind lang:Lang.ReShadeDownloadView_SkipThisStep}" />
                </Button>

                <!-- Next Button -->
                <Button Height="40"
                        BorderThickness="0"
                        Command="{x:Bind NextCommand}"
                        IsEnabled="{x:Bind CanNext, Mode=OneWay}"
                        Style="{ThemeResource AccentButtonStyle}"
                        CornerRadius="8,20,20,8">
                    <TextBlock Margin="4,0,8,0" FontSize="14" Text="{x:Bind lang:Lang.HoYoShadeDownloadView_Next}" />
                </Button>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
